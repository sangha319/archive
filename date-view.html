<script>
  /* 날짜 변환 함수 */
  function formatKoreanDate(dateStr) {
    const [year, month, day] = dateStr.split("-");
    const date = new Date(year, month - 1, day);

    const dayNames = ["일요일","월요일","화요일","수요일","목요일","금요일","토요일"];
    const dayName = dayNames[date.getDay()];

    return `${year}년 ${Number(month)}월 ${Number(day)}일 ${dayName}`;
  }

  /* URL 날짜 가져오기 */
  const params = new URLSearchParams(window.location.search);
  const selectedDate = params.get("date");

  document.getElementById("date-title").innerText =
    formatKoreanDate(selectedDate);

  /* 메시지 불러오기 */
  fetch("/archive/messages.json")
    .then(res => res.json())
    .then(data => {
      const msgBox = document.getElementById("messages");
      const filtered = data.filter(msg => msg.date === selectedDate);

      let prevMsg = null;

      filtered.forEach(msg => {
        const block = document.createElement("div");
        block.className = "message-block";

        const isContinuous =
          prevMsg &&
          prevMsg.time === msg.time;

        /* 첫 메시지 or 시간이 다른 메시지 */
        if (!isContinuous) {
          block.innerHTML = `
            <img class="avatar" src="SANGHA.jpg">
            <div class="msg-right">
              <div class="sender-line">
                <span class="name">SANGHA</span>
                <span class="time">${msg.time}</span>
              </div>
              <div class="bubble">${msg.text.replace(/\n/g, "<br>")}</div>
            </div>
          `;
        }

        /* 연속 메시지 (프사·이름·시간 숨김) */
        else {
          block.innerHTML = `
            <div class="msg-right continuous">
              <div class="bubble">${msg.text.replace(/\n/g, "<br>")}</div>
            </div>
          `;
        }

        msgBox.appendChild(block);
        prevMsg = msg;
      });
    });
</script>
