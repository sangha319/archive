fetch("messages.json?v=" + Date.now())  // ðŸ”¥ ìºì‹œ ë°©ì§€ + ì˜¬ë°”ë¥¸ ê²½ë¡œ
  .then(res => {
    if (!res.ok) {
      throw new Error("messages.jsonì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
    return res.json();
  })
  .then(data => {
    const msgBox = document.getElementById("messages");
    const filtered = data.filter(msg => msg.date === selectedDate);

    let prevMsg = null;

    filtered.forEach(msg => {
      const block = document.createElement("div");
      block.className = "message-block";

      const isContinuous = prevMsg && prevMsg.time === msg.time;

      if (!isContinuous) {
        block.innerHTML = `
          <img class="avatar" src="SANGHA.jpg">
          <div class="msg-right">
            <div class="sender-line">
              <span class="name">SANGHA</span>
              <span class="time">${msg.time}</span>
            </div>
            <div class="bubble">${msg.text.replace(/\\n/g, "<br>")}</div>
          </div>
        `;
      } else {
        block.innerHTML = `
          <div class="msg-right continuous">
            <div class="bubble">${msg.text.replace(/\\n/g, "<br>")}</div>
          </div>
        `;
      }

      msgBox.appendChild(block);
      prevMsg = msg;
    });
  })
  .catch(err => {
    console.error(err);
    document.getElementById("messages").innerHTML =
      "<p style='color:white; text-align:center; margin-top:30px;'>ë©”ì‹œì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
  });
